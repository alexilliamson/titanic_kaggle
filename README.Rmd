---
title: "Titanic"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(caret)
```


### Data  

```{r}
labeled_df <- read_csv('data/train.csv', col_types = cols(
        PassengerId = col_integer(),
        Survived = col_integer(),
        Pclass = col_integer(),
        Name = col_character(),
        Sex = col_character(),
        Age = col_double(),
        SibSp = col_integer(),
        Parch = col_integer(),
        Ticket = col_character(),
        Fare = col_double(),
        Cabin = col_character(),
        Embarked = col_character())
        ) %>% 
        mutate(Survived = factor(Survived, levels = c(0,1), 
                                         labels = c('no_survive', 'survive') ))

submission_df <- read_csv('data/test.csv', col_types = cols(
        PassengerId = col_integer(),
        Pclass = col_integer(),
        Name = col_character(),
        Sex = col_character(),
        Age = col_double(),
        SibSp = col_integer(),
        Parch = col_integer(),
        Ticket = col_character(),
        Fare = col_double(),
        Cabin = col_character(),
        Embarked = col_character()
))
```

### Determine Predictors  

Which fields are present in both datasets?  

```{r}
combined_data <- submission_df %>% 
        mutate(IsTrain = FALSE) %>%
        bind_rows(mutate(labeled_df, IsTrain = TRUE))

combined_data %>%
        group_by(IsTrain) %>%
        summarise_all(~sum(is.na(.x)))
```

Select the non-missing features that would make sense as predictors

```{r}
predictors <- combined_data %>%
        select_if(~sum(is.na(.x)) == 0) %>%
        select(-PassengerId,-Name,-Ticket, -IsTrain) %>%
        names()

predictors
```

### Split training/holdout  

```{r}
set.seed(100)

train_index <- createDataPartition(labeled_df$Survived, p = 0.8, list = FALSE)

train_df <- labeled_df[train_index,]

holdout_df <- labeled_df[-train_index,]
```

